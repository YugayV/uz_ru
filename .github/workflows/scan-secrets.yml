name: Scan for committed secrets

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan repository for common secret patterns
        run: |
          set -e
          # Simple regex checks - fail if matches found
          echo "Scanning for OpenAI/DeepSeek keys and Telegram tokens..."
          if git grep -nE "sk-[A-Za-z0-9_-]{20,}" -- ':!venv' ':!*.png' ':!*.jpg' ; then
            echo "Potential secret (sk-...) found in repo. Aborting."; exit 1
          fi
          if git grep -nE "[0-9]{9}:[A-Za-z0-9_-]{35,}" -- ':!venv' ; then
            echo "Potential Telegram token found in repo. Aborting."; exit 1
          fi
          echo "No obvious secrets found."
