<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Capy ‚Äî –ú–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  </head>
  <body style="font-family: sans-serif; text-align:center; padding: 20px;">
    <h1>–ö–∞–ø–∏–±–∞—Ä–∞ ü¶´</h1>
    <img id="capy-img" src="capybara_happy.svg" alt="capy" style="width:60%" />
    <div>
      <button id="play">üéß –ü–æ—Å–ª—É—à–∞—Ç—å –ø–æ—Ö–≤–∞–ª—É</button>
      <button id="encourage">ü§ó –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</button>
    </div>
    <p id="phrase" style="font-size: 1.2em; margin-top: 20px"></p>

    <script>
      async function load(){
        try{
          const res = await fetch('/character/capybara');
          if(!res.ok){
            document.body.innerHTML = '<h2>–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h2>';
            return;
          }
          const data = await res.json();
          window.CAP = data;
          document.getElementById('capy-img').src = '/static/' + data.emotions.happy.image;
        }catch(e){
          document.body.innerHTML = '<h2>–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.</h2>';
        }
      }
      load();

      document.getElementById('play').addEventListener('click', async ()=>{
        const data = window.CAP;
        const audio = new Audio('/static/'+ data.emotions.happy.audio);
        audio.play();
        document.getElementById('phrase').textContent = data.emotions.happy.phrases[0];
      });

      document.getElementById('encourage').addEventListener('click', async ()=>{
        const data = window.CAP;
        const audio = new Audio('/static/'+ data.emotions.encourage.audio);
        audio.play();
        document.getElementById('phrase').textContent = data.emotions.encourage.phrases[0];
      });
    </script>
  </body>
</html>